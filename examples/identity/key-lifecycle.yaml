name: Key Lifecycle Management
description: |
  Cryptographic key lifecycle operations:
  1. Generate key pair (POST /v1/keys)
  2. Rotate keys (POST /v1/keys/rotate)
  3. List keys (GET /v1/keys)
  4. Get key details (GET /v1/keys/{id})
  5. Revoke key (DELETE /v1/keys/{id})
  6. Error scenarios (unauthorized, key not found, already revoked)
steps:
  # Step 1: Generate Key Pair
  - name: Generate Cryptographic Key Pair
    description: Generate a new Ed25519 key pair for identity
    request:
      method: POST
      url: https://api.registryaccord.com/identity/v1/keys
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440034"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6d3JpdGUiLCJpYXQiOjE3MzA4ODE4MDAsImV4cCI6MTczMDg4NTQwMH0.signature"
        Content-Type: "application/json"
      body:
        identity_id: "123e4567-e89b-12d3-a456-426614174000"
        key_type: Ed25519
        usage: SIGNATURE
        expires_in: 31536000
    responses:
      success:
        status: 201
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440034"
          X-RateLimit-Limit: "100"
          X-RateLimit-Remaining: "99"
          X-RateLimit-Reset: "1730885400"
        body:
          id: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
          identity_id: "123e4567-e89b-12d3-a456-426614174000"
          key_type: Ed25519
          usage: SIGNATURE
          public_key: "MCowBQYDK2VwAyEAJrQLj5P/89iXES9Bv4gMNB+2j4N5vuxr4/LL8P8K35Y="
          kid: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
          created_at: "2025-11-06T11:10:00Z"
          expires_at: "2026-11-06T11:10:00Z"
          revoked_at: null
          is_active: true

  # Step 2: Rotate Keys
  - name: Rotate Cryptographic Keys
    description: Rotate keys for an identity, creating new key and revoking old
    request:
      method: POST
      url: https://api.registryaccord.com/identity/v1/keys/rotate
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440035"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6d3JpdGUiLCJpYXQiOjE3MzA4ODE4MDAsImV4cCI6MTczMDg4NTQwMH0.signature"
        Content-Type: "application/json"
      body:
        identity_id: "123e4567-e89b-12d3-a456-426614174000"
        key_type: Ed25519
        usage: SIGNATURE
        expires_in: 31536000
    responses:
      success:
        status: 200
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440035"
          X-RateLimit-Limit: "100"
          X-RateLimit-Remaining: "98"
          X-RateLimit-Reset: "1730885400"
        body:
          rotated_keys:
            - id: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
              identity_id: "123e4567-e89b-12d3-a456-426614174000"
              key_type: Ed25519
              usage: SIGNATURE
              public_key: "MCowBQYDK2VwAyEAJrQLj5P/89iXES9Bv4gMNB+2j4N5vuxr4/LL8P8K35Y="
              kid: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
              created_at: "2025-11-06T11:10:00Z"
              expires_at: "2026-11-06T11:10:00Z"
              revoked_at: "2025-11-06T11:11:00Z"
              is_active: false
          new_key:
            id: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
            identity_id: "123e4567-e89b-12d3-a456-426614174000"
            key_type: Ed25519
            usage: SIGNATURE
            public_key: "MCowBQYDK2VwAyEAdkZIhJ6r+3z1x9p4q8n7m6l5k4j3i2h1g0f9e8d7c6b="
            kid: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
            created_at: "2025-11-06T11:11:00Z"
            expires_at: "2026-11-06T11:11:00Z"
            revoked_at: null
            is_active: true

  # Step 3: List Keys
  - name: List Cryptographic Keys
    description: List all keys for an identity
    request:
      method: GET
      url: https://api.registryaccord.com/identity/v1/keys?identity_id=123e4567-e89b-12d3-a456-426614174000&limit=10
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440036"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6cmVhZCIsImlhdCI6MTczMDg4MTgwMCwiZXhwIjoxNzMwODg1NDAwfQ.signature"
    responses:
      success:
        status: 200
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440036"
          X-RateLimit-Limit: "1000"
          X-RateLimit-Remaining: "999"
          X-RateLimit-Reset: "1730885400"
        body:
          data:
            - id: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
              identity_id: "123e4567-e89b-12d3-a456-426614174000"
              key_type: Ed25519
              usage: SIGNATURE
              public_key: "MCowBQYDK2VwAyEAJrQLj5P/89iXES9Bv4gMNB+2j4N5vuxr4/LL8P8K35Y="
              kid: "b2c3d4e5-f6g7-8901-2345-678901abcdef"
              created_at: "2025-11-06T11:10:00Z"
              expires_at: "2026-11-06T11:10:00Z"
              revoked_at: "2025-11-06T11:11:00Z"
              is_active: false
            - id: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
              identity_id: "123e4567-e89b-12d3-a456-426614174000"
              key_type: Ed25519
              usage: SIGNATURE
              public_key: "MCowBQYDK2VwAyEAdkZIhJ6r+3z1x9p4q8n7m6l5k4j3i2h1g0f9e8d7c6b="
              kid: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
              created_at: "2025-11-06T11:11:00Z"
              expires_at: "2026-11-06T11:11:00Z"
              revoked_at: null
              is_active: true
          pagination:
            has_next_page: false
            next_cursor: null

  # Step 4: Get Key Details
  - name: Get Key Details
    description: Retrieve details of a specific key
    request:
      method: GET
      url: https://api.registryaccord.com/identity/v1/keys/c3d4e5f6-g7h8-9012-3456-789012abcdef
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440037"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6cmVhZCIsImlhdCI6MTczMDg4MTgwMCwiZXhwIjoxNzMwODg1NDAwfQ.signature"
    responses:
      success:
        status: 200
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440037"
          X-RateLimit-Limit: "1000"
          X-RateLimit-Remaining: "998"
          X-RateLimit-Reset: "1730885400"
        body:
          id: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
          identity_id: "123e4567-e89b-12d3-a456-426614174000"
          key_type: Ed25519
          usage: SIGNATURE
          public_key: "MCowBQYDK2VwAyEAdkZIhJ6r+3z1x9p4q8n7m6l5k4j3i2h1g0f9e8d7c6b="
          kid: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
          created_at: "2025-11-06T11:11:00Z"
          expires_at: "2026-11-06T11:11:00Z"
          revoked_at: null
          is_active: true

  # Step 5: Revoke Key
  - name: Revoke Cryptographic Key
    description: Revoke a key to invalidate it immediately
    request:
      method: DELETE
      url: https://api.registryaccord.com/identity/v1/keys/c3d4e5f6-g7h8-9012-3456-789012abcdef
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440038"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6ZGVsZXRlIiwiaWF0IjoxNzMwODgxODAwLCJleHAiOjE3MzA4ODU0MDB9.signature"
    responses:
      success:
        status: 200
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440038"
          X-RateLimit-Limit: "100"
          X-RateLimit-Remaining: "97"
          X-RateLimit-Reset: "1730885400"
        body:
          id: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
          identity_id: "123e4567-e89b-12d3-a456-426614174000"
          key_type: Ed25519
          usage: SIGNATURE
          public_key: "MCowBQYDK2VwAyEAdkZIhJ6r+3z1x9p4q8n7m6l5k4j3i2h1g0f9e8d7c6b="
          kid: "c3d4e5f6-g7h8-9012-3456-789012abcdef"
          created_at: "2025-11-06T11:11:00Z"
          expires_at: "2026-11-06T11:11:00Z"
          revoked_at: "2025-11-06T11:12:00Z"
          is_active: false

  # Step 6: Error Scenarios
  - name: Unauthorized Key Access
    description: Attempt to access keys without proper authentication
    request:
      method: GET
      url: https://api.registryaccord.com/identity/v1/keys?identity_id=123e4567-e89b-12d3-a456-426614174000
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440039"
    responses:
      unauthorized:
        status: 401
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440039"
        body:
          type: "https://api.registryaccord.com/errors/auth_failed"
          title: "Authentication Failed"
          status: 401
          detail: "Missing or invalid authorization header"
          instance: "/v1/keys"
          trace_id: "550e8400-e29b-41d4-a716-446655440039"

  - name: Key Not Found
    description: Attempt to access a non-existent key
    request:
      method: GET
      url: https://api.registryaccord.com/identity/v1/keys/00000000-0000-0000-0000-000000000000
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440040"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6cmVhZCIsImlhdCI6MTczMDg4MTgwMCwiZXhwIjoxNzMwODg1NDAwfQ.signature"
    responses:
      not_found:
        status: 404
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440040"
        body:
          type: "https://api.registryaccord.com/errors/resource_not_found"
          title: "Resource Not Found"
          status: 404
          detail: "Key with ID '00000000-0000-0000-0000-000000000000' not found"
          instance: "/v1/keys/00000000-0000-0000-0000-000000000000"
          trace_id: "550e8400-e29b-41d4-a716-446655440040"

  - name: Already Revoked Key
    description: Attempt to revoke an already revoked key
    request:
      method: DELETE
      url: https://api.registryaccord.com/identity/v1/keys/c3d4e5f6-g7h8-9012-3456-789012abcdef
      headers:
        RA-API-Version: "2025-11-01"
        X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440041"
        Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwic2NvcGUiOiJrZXk6ZGVsZXRlIiwiaWF0IjoxNzMwODgxODAwLCJleHAiOjE3MzA4ODU0MDB9.signature"
    responses:
      conflict:
        status: 409
        headers:
          RA-API-Version: "2025-11-01"
          X-Correlation-ID: "550e8400-e29b-41d4-a716-446655440041"
        body:
          type: "https://api.registryaccord.com/errors/conflict"
          title: "Conflict"
          status: 409
          detail: "Key with ID 'c3d4e5f6-g7h8-9012-3456-789012abcdef' is already revoked"
          instance: "/v1/keys/c3d4e5f6-g7h8-9012-3456-789012abcdef"
          trace_id: "550e8400-e29b-41d4-a716-446655440041"
